# **The-Commander: Build Plan (v1.1.0) - Status at 10pm**

**Date:** 2025-12-30 22:00  
**Current Phase:** Core Managers (In Progress)

---

## **The-Commander: Build Plan (v1.1.0)**

### **✅ COMPLETED**
1. **System Design Document** (THE-COMMANDER-SYSTEM-DESIGNv1.1.0.md)
   - Core command set (system/node/agent lifecycle control)
   - Multi-interface architecture (REST API, TUI, Web GUI)
   - Persistent message memory system design
   - Directory structure and state management
   - Version controlled with v1.0.0 archived

2. **Directory Structure Scaffolded**
   - `commander_os/core/` — core managers (stub)
   - `commander_os/interfaces/` — API, TUI, GUI layers (stub)
   - `commander_os/utils/` — utilities and memory system (stub)
   - `config/agents/` — agent configuration storage
   - `memory/` — persistent SQLite message store
   - `logs/` — system and component logs

3. **GitHub Commit & Push**
   - All initial structure committed
   - Design documents versioned

---

### **IN PROGRESS → NEXT PHASE**

#### **Phase 1: Core Managers** (Build Order)
```python
1. config_manager.py
   ├─ Load relay.yaml (static network config)
   ├─ Load agent YAML configs (dynamic, hot-reloadable)
   ├─ Load roles.yaml (role definitions)
   ├─ Validate all configs against schema
   └─ Expose config CRUD operations

2. state.py
   ├─ In-memory system state tracker
   ├─ System status (running/stopped/error)
   ├─ Node registry (all active nodes)
   ├─ Agent registry (per-node agent state)
   ├─ Role assignments (current roles for each agent)
   └─ Thread-safe state updates

3. system_manager.py
   ├─ start_system() — bootstrap relay + all nodes + all agents
   ├─ stop_system() — graceful shutdown
   ├─ status_system() — health report + component status
   └─ System-level event broadcasting

4. node_manager.py
   ├─ start_node(node_id) — launch node processes
   ├─ stop_node(node_id) — shutdown node
   ├─ status_node(node_id) — node health + agents on node
   ├─ register_node(node_id, config) — dynamic node registration
   └─ Node heartbeat monitoring

5. agent_manager.py
   ├─ start_agent(node_id, agent_id) — launch agent process
   ├─ stop_agent(node_id, agent_id) — shutdown agent
   ├─ status_agent(node_id, agent_id) — agent state + model info
   ├─ config_agent(agent_id, params) — modify agent config (hot-reload)
   ├─ set_agent_role(agent_id, role) — override agent role
   └─ list_agents(node_id) — enumerate agents on node
```

#### **Phase 2: Persistent Memory System**
```python
memory.py (core logic)
├─ MessageStore (SQLite backend)
│  ├─ Log message (capture relay traffic)
│  ├─ Compress message (gzip + dedup)
│  ├─ Query memory (search by task_id, sender, recipient, timestamp)
│  ├─ Summarize task (create executive summaries)
│  ├─ Archive messages (move old > N days)
│  └─ Daily compaction job
│
├─ Message Schema
│  ├─ timestamp (ISO 8601)
│  ├─ sender (agent_id/node_id)
│  ├─ recipient(s) (list of agent_ids)
│  ├─ role (architect/coder/reasoner/synthesizer)
│  ├─ task_id (correlate related messages)
│  ├─ iteration (message count in task)
│  ├─ content (gzip compressed)
│  ├─ metadata (tags, keywords)
│  └─ hash (for dedup detection)
│
└─ Memory Tables (SQLite)
   ├─ messages (raw logs, indexed)
   ├─ message_summaries (compressed per-task)
   ├─ agent_interactions (flattened queries)
   ├─ memory_index (full-text search)
   └─ compaction_log (audit trail)
```

#### **Phase 3: REST API** (FastAPI)
```python
rest_api.py
├─ System Endpoints
│  ├─ POST /system/start
│  ├─ POST /system/stop
│  └─ GET /system/status
│
├─ Node Endpoints
│  ├─ POST /nodes/{node_id}/start
│  ├─ POST /nodes/{node_id}/stop
│  ├─ GET /nodes/{node_id}/status
│  └─ GET /nodes (list all)
│
├─ Agent Endpoints
│  ├─ POST /agents/{agent_id}/start
│  ├─ POST /agents/{agent_id}/stop
│  ├─ GET /agents/{agent_id}/status
│  ├─ PATCH /agents/{agent_id}/config
│  ├─ PATCH /agents/{agent_id}/role
│  └─ GET /agents (list all)
│
└─ Memory Endpoints
   ├─ GET /memory/search?task_id=X
   ├─ GET /memory/agent?sender=X&recipient=Y
   ├─ GET /memory/summary?task_id=X
   └─ GET /memory/similar?content=...
```

#### **Phase 4: TUI Dashboard** (Textual)
```python
tui.py
├─ System Status Panel
│  ├─ Overall system state
│  ├─ Uptime, node count, agent count
│  └─ Recent events log
│
├─ Node View (scrollable list)
│  ├─ Node ID, status, uptime
│  ├─ Connected agents, resource usage
│  └─ Quick controls (start/stop)
│
├─ Agent View (per-node)
│  ├─ Agent ID, current role, model
│  ├─ Context size, NGL, FA status
│  ├─ Memory address, last heartbeat
│  └─ Quick controls (start/stop)
│
└─ Keyboard Controls
   ├─ Arrow keys — navigate
   ├─ Space — start/stop selected
   ├─ 'c' — configure agent
   ├─ 'm' — view memory for agent
   └─ 'q' — quit
```

#### **Phase 5: Web GUI** (FastAPI + Vue.js)
```python
web_gui.py / static/ / templates/
├─ Dashboard
│  ├─ System health overview
│  ├─ Node status grid
│  └─ Recent agent events
│
├─ Node Management
│  ├─ Start/stop individual nodes
│  ├─ View node details, agents
│  └─ Resource monitoring (live)
│
├─ Agent Configuration
│  ├─ Agent selector (dropdown)
│  ├─ Model path input
│  ├─ Context size slider
│  ├─ NGL slider (0-80)
│  ├─ Flash attention toggle
│  ├─ Role selector (dropdown)
│  ├─ Network address input
│  └─ Apply/Reset buttons
│
└─ Memory Browser
   ├─ Task ID search
   ├─ Agent interaction graphs
   ├─ Message timeline
   └─ Summary export
```

#### **Phase 6: Launcher Scripts**
```bash
# commander_launcher.sh (Linux/WSL)
├─ Detect platform (native Linux / WSL2)
├─ Check Python + dependencies
├─ Create memory/logs dirs
├─ Start relay_server.py (background)
├─ Start node managers (background)
├─ Start agent processes (background)
├─ Wait for services ready
├─ Launch TUI or Web GUI (foreground)
└─ Graceful shutdown on Ctrl+C

# commander_launcher.bat (Windows)
├─ Detect Python + Llama.cpp
├─ Check admin privileges (optional)
├─ Create memory/logs dirs
├─ Start relay_server.py (detached)
├─ Start node managers (detached)
├─ Start agent processes (detached)
├─ Open Web GUI in browser
└─ Monitor health in background

# bootstrap.py (shared)
├─ Load relay.yaml
├─ Spawn processes (cross-platform)
├─ PID tracking
├─ Health monitoring
└─ Graceful shutdown handling
```

---

## **Execution Sequence**

1. **User runs launcher** → `./commander_launcher.sh` or `commander_launcher.bat`
2. **Bootstrap starts**:
   - Loads `config/relay.yaml` (static topology)
   - Starts relay server (message hub)
   - Starts node managers (based on config)
   - Starts agents on each node
   - Creates `commander_memory.db` if not exists
3. **User interfaces**:
   - **TUI**: Real-time monitoring in terminal
   - **Web GUI**: Opens browser for configuration
   - **REST API**: Ready for programmatic control
4. **System runs**:
   - Relay routes all agent messages
   - Memory system logs/compresses/indexes all communications
   - Config changes hot-reload agent configurations
   - Role assignments user-overridable anytime
5. **Graceful shutdown**: Ctrl+C on launcher → stops all services cleanly

---

## **Key Design Principles**

✅ **Single one-shot launch** — Everything via launcher script  
✅ **Multi-interface** — CLI, TUI, REST API, Web GUI all available simultaneously  
✅ **Persistent state** — Configs in YAML, memory in SQLite  
✅ **Hot-reloadable** — Agent configs update without restart  
✅ **User control** — Override roles, modify parameters anytime  
✅ **Audit trail** — Complete message history + compression + searchability  
✅ **Llama.cpp passthrough** — All parameters exposed and configurable  

---

## **Dependencies (to install)**

```
fastapi
uvicorn
textual
pyyaml
pydantic
sqlalchemy
gzip (stdlib)
logging (stdlib)
subprocess (stdlib)
psutil (for process management)
```

---

## **Next Immediate Actions**

**Phase 1: Core Managers - Build in this order:**
1. `config_manager.py` — Load and validate all YAML configs
2. `state.py` — In-memory state tracker (thread-safe)
3. `system_manager.py` — System-level lifecycle control
4. `node_manager.py` — Node lifecycle management
5. `agent_manager.py` — Agent lifecycle and configuration

**Then commit to GitHub with version bump.**

Ready to build Phase 1?
